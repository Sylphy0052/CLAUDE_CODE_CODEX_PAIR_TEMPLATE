# AI駆動開発ワークフロー 総合ガイド (v5.0)

このドキュメントは、本プロジェクトで定義されたカスタムAIワークフローの全体像、各コンポーネントの仕様、そして具体的な使用方法について解説する総合的なマニュアルです。

## 1. 概要と設計思想

本ワークフローは、**AIエージェントを専門家チームとして活用**し、開発者が準備した計画（仕様書 or アイデア）に基づき、TDD（テスト駆動開発）による実装から規律あるバージョン管理まで、開発ライフサイクルの中核を**自動化・サポート**することを目的としています。

中核となるのは、**計画駆動の実装思想**です。開発者が定義した明確なゴールに向かって、AIチームが自律的にTDDサイクルを回すことで、高品質なコードを効率的に生産します。各エージェントは、ファイル操作やコマンド実行を確実に行うための具体的な手順を指示されています。

## 2. ディレクトリ構成

プロジェクトは以下のディレクトリ構造を基本とします。

```plaintext
my-ai-project/
├── .claude/
│   ├── agents/
│   │   └── ... (各種エージェント定義ファイル)
│   └── commands/
│       └── ... (各種カスタムコマンド定義ファイル)
│   └── .flow/
│       ├── tasks.md
│       └── state.json
│
├── .reviews/
│   └── 20251003_043000.md (implementコマンドのレビュー結果)
│
├── docs/
│   └── spec.md (開発者が準備する仕様書)
│
├── CLAUDE.md
└── AGENTS.md
```

## 3. 主要な設定ファイル

- **`CLAUDE.md`**: プロジェクト全体のAIに対する**基本設定ファイル（憲法）**。
- **`AGENTS.md`**: **Codex CLI専用の指示書**。

## 4. 推奨ワークフロー：計画駆動開発

開発を開始する場合、以下の手順を推奨します。

### ステップ1: 開発計画の立案とフローの初期化 🗺️

まず、実装する機能の計画を立て、`/flow-init`コマンドでTDDワークフローを開始します。既存のフローがある場合は自動で上書きされます。

**【パターンA: 仕様書から開始する場合】**
開発者が事前に`docs/spec.md`を作成します。

```bash

# docs/spec.mdを読み込み、タスクリストを生成

/flow-init docs/spec.md
```

**【パターンB: アイデアから開始する場合】**
AIにタスクの洗い出しを任せます。

```bash

# 簡単な指示からタスクリストを生成

/flow-init "ユーザー登録用のAPIエンドポイントを作成する"
```

### ステップ2: TDDサイクルによる実装 ⚙️

準備が整ったら、`/flow-run`でTDDサイクルを自動実行します。

```bash

# 現在のタスクが完了するまでTDDサイクルを自動実行

/flow-run
```

### ステップ3: バージョン管理 ✅

機能の実装が完了したら、`/ccommit`で自動コミットします。

```bash

# AIが変更内容を分析し、確認なしで自動コミット

/ccommit "feat: ユーザー登録機能を追加"
```

---

## 5. カスタムコマンド リファレンス

| コマンド | 説明 |
| :--- | :--- |
| **`/flow-init`** | **[開発フロー初期化]** 仕様書またはアイデアから開発タスクを抽出し、フローを初期化します。既存のフローは上書きされます。 |
| **`/flow-status`** | **[進捗確認]** 現在のタスクリストの進捗と、TDDサイクルのフェーズを表示します。 |
| **`/flow-next`** | **[TDDサイクル実行]** TDDサイクルを1ステップ進めます。`--codex`オプションで実装AIを選択できます。 |
| **`/flow-run`** | **[TDDサイクル連続実行]** 一つのタスクが完了するまで`/flow-next`を自動で繰り返します。 |
| **`/flow-reset`** | **[プロジェクトリセット]** 現在のフローを、バックアップを作成した上で確認なしで即時リセットします。 |
| **`/ccommit`** | **[自動Gitコミット]** 現在の変更をAIが分析し、確認なしでConventional Commitメッセージを生成してコミットします。 |
| **`/implement`** | **[単発実装]** AIが文脈を判断し新規ファイル作成または既存ファイルを修正後、Claudeがレビュー結果をタイムスタンプ付きファイルで`.reviews/`に保存します。 |
| **`/refactor`** | **[自動リファクタリング]** 既存のテストが成功することを保証しながら、確認なしで安全にコードをリファクタリングします。 |
| **`/review`** | **[多角的レビュー]** 指定されたコードをAIがレビューします。`--codex`または`--claude`オプションでAIを単独指定できます。 |

---

## 6. サブエージェント（AIチーム）リファレンス

| エージェント | 役割 |
| :--- | :--- |
| **`@state-manager`** | **システム管理者**。`.claude/.flow/`の状態（`state.json`, `tasks.md`）を安全に管理する。 |
| **`@plan-converter`** | **計画コンバーター**。仕様書をタスクリストに忠実に変換する。 |
| **`@planner`** | **創造的プランナー**。簡単な指示（アイデア）から、タスクをゼロから考案する。 |
| **`@test-writer`** | **QAエンジニア**。TDDのRedフェーズで、失敗するテストコードを作成する。 |
| **`@implementer`** | **開発者 (Claude)**。TDDのGreen/Refactorフェーズでコードを実装・改善する。 |
| **`@codex-implementer`** | **開発者 (Codex)**。`--codex`オプション時にコードを実装・改善する。 |
| **`@code-reviewer`** | **レビュアー (Claude)**。TDDのRefactorフェーズや単発レビューを担当する。 |
| **`@codex-reviewer`** | **レビュアー (Codex)**。文脈に応じてTDDのリファクタリングと単発レビューの両方を担当する。 |
| **`@refactorer`** | **リファクタリング専門家**。`/refactor`コマンドで、テストの安全性を保証しながらコードを改善する。 |
| **`@git-committer`** | **Git専門家**。`/ccommit`コマンドで、変更内容を分析し自動でコミットを実行する。 |
