---
description: |
  [プロジェクト初期化] 仕様書から開発タスクを抽出し、タスクリストと状態ファイルを生成します。
argument_hint: "[仕様書のファイルパス] [--reset (任意)]"
notes: |
  バージョン: 1.0
  計画担当: @planner
  状態管理: @state-manager
---
# Flow: プロジェクト初期化コマンド (flow-init)

このコマンドは、指定された仕様書（例: `docs/spec.md`）を読み込み、AIが実行可能なタスクリスト（`.flow/tasks.md`）と、進捗を管理する状態ファイル（`.flow/state.json`）を自動生成します。

## 使用例

```bash
# docs/spec.md を基にプロジェクトを初期化
/flow-init docs/spec.md

# 既存のタスクをリセットして、新しい仕様書で再初期化
/flow-init docs/new_spec.md --reset
```

---

## 実行フロー

### ステップ1: 事前チェックとセットアップ

まず、既存の状態ファイルがあるか確認します。

- **もし `.flow` ディレクトリが既に存在する場合:**
  - **そして `--reset` オプションが指定されていない場合:**
        処理を**中断**し、「エラー: 既存のタスクリストが見つかりました。再初期化するには `--reset` オプションを付けてください。または `flow-reset` コマンドでリセットしてください。」と報告してください。
  - **そして `--reset` オプションが指定されている場合:**
        `@state-manager` を呼び出し、既存の状態を安全にリセット（バックアップ作成後に削除）してください。
        `@state-manager`
    - **Operation:** reset
    - **Details:** 安全なバックアップを作成した後、状態をリセットしてください。

- **もし `.flow` ディレクトリが存在しない場合:**
    `.flow` ディレクトリを新規に作成してください。

### ステップ2: 開発計画の策定 (by @planner)

**進捗報告:**
「ステップ2/3: 仕様書を分析し、開発計画を策定します...」

`@planner` エージェントを呼び出し、指定された仕様書から開発計画を策定させます。
生成された計画は、`.flow/tasks.md` というファイルに保存してください。

@planner

- **仕様書ファイル:** `$1`
- **アウトプット:** `.flow/tasks.md`

**成功時報告:**
「開発計画の策定が完了し、`.flow/tasks.md` に保存しました。」

### ステップ3: 状態ファイルの初期化 (by @state-manager)

**進捗報告:**
「ステップ3/3: プロジェクトの状態を初期化します...」

`@state-manager` エージェントを呼び出し、状態ファイル `.flow/state.json` を初期状態で作成させます。初期フェーズは常に `red` です。

@state-manager

- **Operation:** initialize_state
- **Initial State:** `{ "phase": "red" }`
- **Output File:** `.flow/state.json`

**成功時報告:**
「状態ファイルの初期化が完了しました。」

### ステップ4: 最終報告

全ての初期化プロセスが完了したことを報告し、最後に `@state-manager` を呼び出して、生成されたばかりのプロジェクトの初期状態を表示してください。

@state-manager

- **Operation:** status
- **Details:** 現在の状態を要約して報告してください。
