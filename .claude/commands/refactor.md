---
description: |
  [リファクタリング] 既存のテストが成功することを保証しながら、安全にコードをリファクタリングします。
argument_hint: "[対象ファイルパス] [リファクタリングの目的] [--codex (任意)]"
notes: |
  バージョン: 1.0
  担当: @refactorer
---
# 安全なリファクタリングコマンド (refactor)

このコマンドは、`@refactorer`エージェントを呼び出し、指定されたコードのリファクタリングを実行します。
AIによる変更が既存の機能を破壊しないよう、コマンド実行の前後でテストスイートが実行され、安全性が保証されます。

## 使用例

```bash
# Claudeを使って、可読性を向上させる

/refactor src/utils.py "calculate_price関数の可読性を向上させて"

# Codexを使って、パフォーマンスを改善する

/refactor src/core.py "process_data関数のパフォーマンスを改善して" --codex
```

---

## 実行フロー

### ステップ1: 引数の解析

ユーザーが指定した「対象ファイルパス」、「リファクタリングの目的」、そして`--codex`オプションの有無を解析します。

### ステップ2: リファクタリングの実行 (by @refactorer)

**進捗報告:**
「リファクタリングを開始します。まず、現在のテストがすべて成功することを確認します...」

`@refactorer`エージェントを呼び出し、解析した引数をすべて渡して、安全なリファクタリングプロセスを実行させます。
エージェントは、成功した場合は「変更差分」を、失敗した場合は「エラー報告」を返します。

### ステップ3: 結果の報告と最終確認

`@refactorer`からの結果に基づき、ユーザーに報告します。

- **もし、リファクタリングに成功した場合:**
  エージェントが生成した変更差分を提示し、「上記の変更を適用しますか？ [Y/N]」とユーザーに最終確認を求めます。
  - **'Y'の場合**: 変更をファイルに維持し、「リファクタリングを適用しました。」と報告します。
  - **'N'の場合**: ファイルへの変更を元に戻し、「操作はキャンセルされました。」と報告します。

- **もし、リファクタリングに失敗した場合（テストが失敗した場合）:**
  エージェントからのエラー報告（例：「リファクタリング案がテストを破壊したため、変更をすべて元に戻しました。」）をそのままユーザーに表示します。
