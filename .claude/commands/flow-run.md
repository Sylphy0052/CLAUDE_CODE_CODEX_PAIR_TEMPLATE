---
description: |
  [TDDサイクル連続実行] 一つのタスクが完了するまで、または指定ステップ数だけflow-nextを自動で繰り返します。
argument_hint: "[--steps <数>] [--codex (任意)]"
notes: |
  バージョン: 1.0
  このコマンドは内部で `flow-next` を呼び出します。
---
# Flow: TDDサイクル連続実行コマンド (flow-run)

このコマンドは、`flow-next`を自動で繰り返し実行し、開発プロセスを高速化します。
デフォルトでは、現在のタスクが完了するまで（Red→Green→Refactorの1サイクルが終了するまで）実行されます。

## 使用例

```bash

# 現在のタスクが完了するまで、Claudeエージェントで自動実行

/flow-run

# 2ステップだけ、Codexエージェントで自動実行

/flow-run --steps 2 --codex
```

## 実行フロー

### ステップ1: 実行条件の決定

コマンドに与えられた引数を解析し、実行の停止条件を決定します。

- **`--steps <数>` オプションが指定されている場合:**
    停止条件は「指定されたステップ数を実行完了すること」です。

- **`--steps` オプションが指定されていない場合（デフォルト）:**
    停止条件は「現在のタスクが完了すること」です。安全のため、最大実行回数を5ステップに設定します。

### ステップ2: `flow-next`の反復実行

決定された停止条件に達するまで、以下のループ処理を実行します。

1. **進捗報告:**
    「実行中... (現在 `N` ステップ目, Phase: `(現在のフェーズ)`)」のように、現在の状況を報告します。

2. **`flow-next`の内部呼び出し:**
    この`flow-run`コマンドに与えられた`--codex`オプションを引き継いで、`/flow-next`コマンドを内部的に実行します。

3. **停止条件のチェック:**
    `/flow-next`の実行後、現在の状態を確認し、停止条件に達したか、またはエラーが発生したかをチェックしてループを制御します。

### ステップ3: 最終報告

ループ処理が正常に完了したことを報告します。

**進捗報告:**
「`flow-run`が正常に完了しました。合計 `N` ステップを実行しました。」

最後に、`@state-manager`を呼び出して、最終的なプロジェクトの状態を表示してください。
